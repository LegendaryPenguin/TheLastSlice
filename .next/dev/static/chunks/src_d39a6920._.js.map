{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nisch/Desktop/pizza-raid/src/lib/supabaseClient.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\r\n\r\nexport const supabaseClient = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n);\r\n"],"names":[],"mappings":";;;;AAGE;AAHF;;AAEO,MAAM,iBAAiB,IAAA,iMAAY"}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nisch/Desktop/pizza-raid/src/lib/moves.ts"],"sourcesContent":["export type Move = {\r\n  id: number;\r\n  name: string;\r\n  cost: number;       // 0..100\r\n  minDmg: number;\r\n  maxDmg: number;\r\n  critChance: number; // 0..1\r\n  animType: \"slash\" | \"fire\" | \"zap\" | \"bite\" | \"meteor\" | \"wave\" | \"spin\" | \"beam\";\r\n};\r\n\r\nexport const MOVES: Move[] = [\r\n  { id: 1,  name: \"Crust Cutter\",      cost: 18, minDmg: 18, maxDmg: 28, critChance: 0.12, animType: \"slash\" },\r\n  { id: 2,  name: \"Sauce Splash\",      cost: 14, minDmg: 12, maxDmg: 22, critChance: 0.10, animType: \"wave\" },\r\n  { id: 3,  name: \"Pineapple Pop\",     cost: 22, minDmg: 20, maxDmg: 34, critChance: 0.13, animType: \"spin\" },\r\n  { id: 4,  name: \"Cheese Melt\",       cost: 16, minDmg: 14, maxDmg: 26, critChance: 0.11, animType: \"wave\" },\r\n\r\n  { id: 5,  name: \"Pepperoni Pummel\",  cost: 26, minDmg: 26, maxDmg: 40, critChance: 0.14, animType: \"bite\" },\r\n  { id: 6,  name: \"Oven Blast\",        cost: 30, minDmg: 30, maxDmg: 46, critChance: 0.15, animType: \"fire\" },\r\n  { id: 7,  name: \"Neon Zest\",         cost: 20, minDmg: 18, maxDmg: 30, critChance: 0.12, animType: \"zap\" },\r\n  { id: 8,  name: \"Garlic Grenade\",    cost: 28, minDmg: 28, maxDmg: 44, critChance: 0.15, animType: \"meteor\" },\r\n\r\n  { id: 9,  name: \"Slice Spiral\",      cost: 12, minDmg: 10, maxDmg: 18, critChance: 0.08, animType: \"spin\" },\r\n  { id: 10, name: \"Anchovy Beam\",      cost: 34, minDmg: 34, maxDmg: 52, critChance: 0.16, animType: \"beam\" },\r\n  { id: 11, name: \"Dough Dropkick\",    cost: 24, minDmg: 22, maxDmg: 36, critChance: 0.13, animType: \"slash\" },\r\n  { id: 12, name: \"Basil Barrage\",     cost: 18, minDmg: 16, maxDmg: 28, critChance: 0.11, animType: \"wave\" },\r\n\r\n  { id: 13, name: \"Mozzarella Meteor\", cost: 40, minDmg: 44, maxDmg: 70, critChance: 0.18, animType: \"meteor\" },\r\n  { id: 14, name: \"Hot Honey Hex\",     cost: 32, minDmg: 32, maxDmg: 50, critChance: 0.16, animType: \"fire\" },\r\n  { id: 15, name: \"Carbonated Zap\",    cost: 22, minDmg: 20, maxDmg: 34, critChance: 0.13, animType: \"zap\" },\r\n  { id: 16, name: \"Final Slice\",       cost: 45, minDmg: 55, maxDmg: 85, critChance: 0.20, animType: \"beam\" },\r\n];\r\n\r\nexport function pickFourRandomMoves(): Move[] {\r\n  const copy = [...MOVES];\r\n  // Fisher-Yates shuffle partial\r\n  for (let i = copy.length - 1; i > 0; i--) {\r\n    const j = Math.floor(Math.random() * (i + 1));\r\n    [copy[i], copy[j]] = [copy[j], copy[i]];\r\n  }\r\n  return copy.slice(0, 4);\r\n}\r\n\r\nexport function getMoveById(id: number): Move | undefined {\r\n  return MOVES.find((m) => m.id === id);\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAUO,MAAM,QAAgB;IAC3B;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAQ;IAC3G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;IAC1G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;IAC1G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;IAE1G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;IAC1G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;IAC1G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAM;IACzG;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAS;IAE5G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;IAC1G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;IAC1G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAQ;IAC3G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;IAE1G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAS;IAC5G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;IAC1G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAM;IACzG;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;CAC3G;AAEM,SAAS;IACd,MAAM,OAAO;WAAI;KAAM;IACvB,+BAA+B;IAC/B,IAAK,IAAI,IAAI,KAAK,MAAM,GAAG,GAAG,IAAI,GAAG,IAAK;QACxC,MAAM,IAAI,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,CAAC,IAAI,CAAC;QAC3C,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,EAAE,CAAC,GAAG;YAAC,IAAI,CAAC,EAAE;YAAE,IAAI,CAAC,EAAE;SAAC;IACzC;IACA,OAAO,KAAK,KAAK,CAAC,GAAG;AACvB;AAEO,SAAS,YAAY,EAAU;IACpC,OAAO,MAAM,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;AACpC"}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nisch/Desktop/pizza-raid/src/components/Lobby.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useMemo, useState } from \"react\";\r\n\r\nexport default function Lobby({\r\n  mode,\r\n  code,\r\n  raid,\r\n  player,\r\n  players,\r\n  onJoin,\r\n  onStart,\r\n  canStart = false,\r\n}: {\r\n  mode: \"join\" | \"lobby\";\r\n  code: string;\r\n  raid: any;\r\n  player: any;\r\n  players: any[];\r\n  onJoin: (f: string, l: string, t: string) => void;\r\n  onStart?: () => void;\r\n  canStart?: boolean; // ‚úÖ host-only\r\n}) {\r\n  const [first, setFirst] = useState(\"\");\r\n  const [last, setLast] = useState(\"\");\r\n  const [tag, setTag] = useState(\"\");\r\n\r\n  const joinedCount = players?.length ?? 0;\r\n\r\n  const shareUrl = useMemo(() => {\r\n    if (typeof window === \"undefined\") return \"\";\r\n    return `${window.location.origin}/raid/${code}`;\r\n  }, [code]);\r\n\r\n  return (\r\n    <div className=\"grid2\">\r\n      {/* LEFT */}\r\n      <div className=\"card\">\r\n        <h2 style={{ marginTop: 0 }}>Lobby</h2>\r\n\r\n        <p style={{ opacity: 0.8 }}>\r\n          Join with your name + 5-digit tag. Once enough people join, the host starts the battle.\r\n        </p>\r\n\r\n        {/* JOIN FORM */}\r\n        {!player && (\r\n          <div className=\"form\">\r\n            <input\r\n              placeholder=\"First Name\"\r\n              value={first}\r\n              onChange={(e) => setFirst(e.target.value)}\r\n            />\r\n            <input\r\n              placeholder=\"Last Name\"\r\n              value={last}\r\n              onChange={(e) => setLast(e.target.value)}\r\n            />\r\n            <input\r\n              placeholder=\"5-digit tag (e.g. 12345)\"\r\n              value={tag}\r\n              onChange={(e) => setTag(e.target.value)}\r\n            />\r\n            <button className=\"btnPrimary\" onClick={() => onJoin(first, last, tag)}>\r\n              Join Room {code}\r\n            </button>\r\n\r\n            <div className=\"pill\" style={{ marginTop: 12 }}>\r\n              <div style={{ opacity: 0.85, lineHeight: 1.6 }}>\r\n                Share with audience: <b style={{ wordBreak: \"break-all\" }}>{shareUrl}</b>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* WAITING VIEW */}\r\n        {player && (\r\n          <>\r\n            <div className=\"pill\">\r\n              You are in as <b>{player.display_name}</b>\r\n            </div>\r\n\r\n            <div className=\"pill\" style={{ marginTop: 12 }}>\r\n              <div style={{ fontWeight: 900, marginBottom: 6 }}>‚è≥ Waiting for host‚Ä¶</div>\r\n              <div style={{ opacity: 0.85, lineHeight: 1.6 }}>\r\n                Stay on this page. When the host starts the raid, you‚Äôll automatically switch to the battle.\r\n              </div>\r\n            </div>\r\n\r\n            <div style={{ marginTop: 14, display: \"flex\", gap: 10, alignItems: \"center\", flexWrap: \"wrap\" }}>\r\n              {/* ‚úÖ Host-only Start button */}\r\n              {canStart && (\r\n                <button\r\n                  className=\"btnPrimary\"\r\n                  onClick={onStart}\r\n                  disabled={!raid || raid?.status !== \"lobby\" || joinedCount < 1}\r\n                  title=\"Start when ready\"\r\n                >\r\n                  Start Raid\r\n                </button>\r\n              )}\r\n\r\n              <span style={{ opacity: 0.75, fontSize: 12 }}>\r\n                Players joined: <b>{joinedCount}</b>\r\n              </span>\r\n\r\n              {raid?.status && (\r\n                <span style={{ opacity: 0.75, fontSize: 12 }}>\r\n                  Status: <b>{raid.status}</b>\r\n                </span>\r\n              )}\r\n            </div>\r\n\r\n            {canStart && (\r\n              <div style={{ opacity: 0.7, fontSize: 12, marginTop: 10 }}>\r\n                Tip: You‚Äôre the host. When you press Start, everyone switches to the battle view.\r\n              </div>\r\n            )}\r\n          </>\r\n        )}\r\n      </div>\r\n\r\n      {/* RIGHT */}\r\n      <div className=\"card\">\r\n        <h3 style={{ marginTop: 0 }}>Players</h3>\r\n        <div className=\"list\">\r\n          {players.map((p) => (\r\n            <div key={p.id} className=\"row\">\r\n              <div className=\"name\">{p.display_name}</div>\r\n              <div className=\"muted\">DMG {p.total_damage}</div>\r\n            </div>\r\n          ))}\r\n          {players.length === 0 && <div className=\"muted\">No one joined yet.</div>}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;;;AAFA;;AAIe,SAAS,MAAM,EAC5B,IAAI,EACJ,IAAI,EACJ,IAAI,EACJ,MAAM,EACN,OAAO,EACP,MAAM,EACN,OAAO,EACP,WAAW,KAAK,EAUjB;;IACC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,yKAAQ,EAAC;IACnC,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAC;IACjC,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,yKAAQ,EAAC;IAE/B,MAAM,cAAc,SAAS,UAAU;IAEvC,MAAM,WAAW,IAAA,wKAAO;mCAAC;YACvB;;YACA,OAAO,GAAG,OAAO,QAAQ,CAAC,MAAM,CAAC,MAAM,EAAE,MAAM;QACjD;kCAAG;QAAC;KAAK;IAET,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAG,OAAO;4BAAE,WAAW;wBAAE;kCAAG;;;;;;kCAE7B,6LAAC;wBAAE,OAAO;4BAAE,SAAS;wBAAI;kCAAG;;;;;;oBAK3B,CAAC,wBACA,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCACC,aAAY;gCACZ,OAAO;gCACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;;;;;;0CAE1C,6LAAC;gCACC,aAAY;gCACZ,OAAO;gCACP,UAAU,CAAC,IAAM,QAAQ,EAAE,MAAM,CAAC,KAAK;;;;;;0CAEzC,6LAAC;gCACC,aAAY;gCACZ,OAAO;gCACP,UAAU,CAAC,IAAM,OAAO,EAAE,MAAM,CAAC,KAAK;;;;;;0CAExC,6LAAC;gCAAO,WAAU;gCAAa,SAAS,IAAM,OAAO,OAAO,MAAM;;oCAAM;oCAC3D;;;;;;;0CAGb,6LAAC;gCAAI,WAAU;gCAAO,OAAO;oCAAE,WAAW;gCAAG;0CAC3C,cAAA,6LAAC;oCAAI,OAAO;wCAAE,SAAS;wCAAM,YAAY;oCAAI;;wCAAG;sDACzB,6LAAC;4CAAE,OAAO;gDAAE,WAAW;4CAAY;sDAAI;;;;;;;;;;;;;;;;;;;;;;;oBAOnE,wBACC;;0CACE,6LAAC;gCAAI,WAAU;;oCAAO;kDACN,6LAAC;kDAAG,OAAO,YAAY;;;;;;;;;;;;0CAGvC,6LAAC;gCAAI,WAAU;gCAAO,OAAO;oCAAE,WAAW;gCAAG;;kDAC3C,6LAAC;wCAAI,OAAO;4CAAE,YAAY;4CAAK,cAAc;wCAAE;kDAAG;;;;;;kDAClD,6LAAC;wCAAI,OAAO;4CAAE,SAAS;4CAAM,YAAY;wCAAI;kDAAG;;;;;;;;;;;;0CAKlD,6LAAC;gCAAI,OAAO;oCAAE,WAAW;oCAAI,SAAS;oCAAQ,KAAK;oCAAI,YAAY;oCAAU,UAAU;gCAAO;;oCAE3F,0BACC,6LAAC;wCACC,WAAU;wCACV,SAAS;wCACT,UAAU,CAAC,QAAQ,MAAM,WAAW,WAAW,cAAc;wCAC7D,OAAM;kDACP;;;;;;kDAKH,6LAAC;wCAAK,OAAO;4CAAE,SAAS;4CAAM,UAAU;wCAAG;;4CAAG;0DAC5B,6LAAC;0DAAG;;;;;;;;;;;;oCAGrB,MAAM,wBACL,6LAAC;wCAAK,OAAO;4CAAE,SAAS;4CAAM,UAAU;wCAAG;;4CAAG;0DACpC,6LAAC;0DAAG,KAAK,MAAM;;;;;;;;;;;;;;;;;;4BAK5B,0BACC,6LAAC;gCAAI,OAAO;oCAAE,SAAS;oCAAK,UAAU;oCAAI,WAAW;gCAAG;0CAAG;;;;;;;;;;;;;;0BASnE,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAG,OAAO;4BAAE,WAAW;wBAAE;kCAAG;;;;;;kCAC7B,6LAAC;wBAAI,WAAU;;4BACZ,QAAQ,GAAG,CAAC,CAAC,kBACZ,6LAAC;oCAAe,WAAU;;sDACxB,6LAAC;4CAAI,WAAU;sDAAQ,EAAE,YAAY;;;;;;sDACrC,6LAAC;4CAAI,WAAU;;gDAAQ;gDAAK,EAAE,YAAY;;;;;;;;mCAFlC,EAAE,EAAE;;;;;4BAKf,QAAQ,MAAM,KAAK,mBAAK,6LAAC;gCAAI,WAAU;0CAAQ;;;;;;;;;;;;;;;;;;;;;;;;AAK1D;GApIwB;KAAA"}},
    {"offset": {"line": 550, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nisch/Desktop/pizza-raid/src/lib/utils.ts"],"sourcesContent":["export function nowMs() {\r\n  return Date.now();\r\n}\r\n\r\nexport function clamp(n: number, a: number, b: number) {\r\n  return Math.max(a, Math.min(b, n));\r\n}\r\n\r\nexport function isFiveDigits(tag: string) {\r\n  return /^[0-9]{5}$/.test(tag);\r\n}\r\n\r\nexport function cleanName(s: string) {\r\n  return s.trim().replace(/\\s+/g, \" \");\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAO,SAAS;IACd,OAAO,KAAK,GAAG;AACjB;AAEO,SAAS,MAAM,CAAS,EAAE,CAAS,EAAE,CAAS;IACnD,OAAO,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,GAAG;AACjC;AAEO,SAAS,aAAa,GAAW;IACtC,OAAO,aAAa,IAAI,CAAC;AAC3B;AAEO,SAAS,UAAU,CAAS;IACjC,OAAO,EAAE,IAAI,GAAG,OAAO,CAAC,QAAQ;AAClC"}},
    {"offset": {"line": 579, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nisch/Desktop/pizza-raid/src/components/BattleArena.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useMemo, useRef, useState } from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport type { Move } from \"@/lib/moves\";\r\nimport { clamp } from \"@/lib/utils\";\r\n\r\nfunction hpColor(pct: number) {\r\n  if (pct > 0.5) return \"#22c55e\";\r\n  if (pct > 0.2) return \"#f59e0b\";\r\n  return \"#ef4444\";\r\n}\r\n\r\nexport default function BattleArena({\r\n  code,\r\n  raid,\r\n  player,\r\n  players,\r\n  attacks,\r\n  moves,\r\n  onAttack,\r\n}: {\r\n  code: string;\r\n  raid: any;\r\n  player: any;\r\n  players: any[];\r\n  attacks: any[];\r\n  moves: Move[];\r\n  onAttack: (moveId: number) => Promise<void> | void;\r\n}) {\r\n  const [shake, setShake] = useState(false);\r\n  const [flashBoss, setFlashBoss] = useState(false);\r\n\r\n  // ‚úÖ NEW: a ticking clock so countdown updates in realtime\r\n  const [now, setNow] = useState(() => Date.now());\r\n  useEffect(() => {\r\n    const id = setInterval(() => setNow(Date.now()), 250);\r\n    return () => clearInterval(id);\r\n  }, []);\r\n\r\n  const [localEnergy, setLocalEnergy] = useState<number>(player?.energy ?? 100);\r\n\r\n  useEffect(() => {\r\n    setLocalEnergy(player?.energy ?? 100);\r\n  }, [player?.energy]);\r\n\r\n  // Smooth regen animation\r\n  useEffect(() => {\r\n    const id = setInterval(() => {\r\n      setLocalEnergy((e) => clamp(e + 2, 0, 100));\r\n    }, 80);\r\n    return () => clearInterval(id);\r\n  }, []);\r\n\r\n  const bossPct = useMemo(() => {\r\n    if (!raid) return 1;\r\n    return clamp(raid.boss_hp / raid.boss_hp_max, 0, 1);\r\n  }, [raid]);\r\n\r\n  const latestAttack = attacks?.[0] ?? null;\r\n\r\n  // ‚úÖ UPDATED: depends on `now` so it ticks down\r\n  const endsIn = useMemo(() => {\r\n    if (!raid?.ends_at) return null;\r\n    const ms = new Date(raid.ends_at).getTime() - now;\r\n    return Math.max(0, Math.floor(ms / 1000));\r\n  }, [raid?.ends_at, now]);\r\n\r\n  // Deduplicate attacks (fix React key warning + realtime duplication)\r\n  const attacksDeduped = useMemo(() => {\r\n    const seen = new Set<string>();\r\n    const out: any[] = [];\r\n\r\n    for (const a of attacks ?? []) {\r\n      const k = String(a.id);\r\n      if (seen.has(k)) continue;\r\n      seen.add(k);\r\n      out.push(a);\r\n    }\r\n\r\n    return out;\r\n  }, [attacks]);\r\n\r\n  // Boss reaction animation\r\n  const lastAttackId = useRef<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!latestAttack?.id) return;\r\n    if (lastAttackId.current === latestAttack.id) return;\r\n\r\n    lastAttackId.current = latestAttack.id;\r\n\r\n    setFlashBoss(true);\r\n    setShake(true);\r\n\r\n    const t1 = setTimeout(() => setFlashBoss(false), 180);\r\n    const t2 = setTimeout(() => setShake(false), 250);\r\n\r\n    return () => {\r\n      clearTimeout(t1);\r\n      clearTimeout(t2);\r\n    };\r\n  }, [latestAttack?.id]);\r\n\r\n  async function doMove(m: Move) {\r\n    if (!player) return;\r\n\r\n    // optimistic energy drop\r\n    setLocalEnergy((e) => Math.max(0, e - m.cost));\r\n\r\n    try {\r\n      await onAttack(m.id);\r\n    } catch {}\r\n  }\r\n\r\n  return (\r\n    <div className=\"grid2\">\r\n      {/* LEFT ‚Äî BATTLE */}\r\n      <div className={`battleShell ${shake ? \"shake\" : \"\"}`}>\r\n        <div className=\"battleField\">\r\n          <div className=\"bgBands\" />\r\n          <div className=\"bgScanlines\" />\r\n\r\n          {/* Enemy HUD */}\r\n          <div className=\"hud enemyHud\">\r\n            <div className=\"hudTop\">\r\n              <div>\r\n                <div className=\"hudTitle\">{raid?.boss_name ?? \"Boss\"}</div>\r\n                <div className=\"hudSub\">RAID BOSS</div>\r\n              </div>\r\n\r\n              <div className=\"hudSub\">‚è± {endsIn ?? \"‚Äî\"}s</div>\r\n            </div>\r\n\r\n            <div className=\"hpRow\">\r\n              <span className=\"hpLabel\">HP</span>\r\n\r\n              <div className=\"hpOuter\">\r\n                <div\r\n                  className=\"hpInner\"\r\n                  style={{\r\n                    width: `${bossPct * 100}%`,\r\n                    background: hpColor(bossPct),\r\n                  }}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"hudSub\" style={{ marginTop: 8 }}>\r\n              {raid?.boss_hp}/{raid?.boss_hp_max}\r\n            </div>\r\n          </div>\r\n\r\n          {/* BOSS */}\r\n          <motion.div\r\n            className={`boss ${flashBoss ? \"hitFlash\" : \"\"}`}\r\n            animate={{ scale: flashBoss ? 1.02 : 1 }}\r\n            transition={{ duration: 0.15 }}\r\n          >\r\n            <div className=\"bossSprite\">üççüçï</div>\r\n            <div className=\"bossNameplate\">PINEAPPLE TITAN</div>\r\n          </motion.div>\r\n\r\n          {/* ATTACK FX */}\r\n          <AnimatePresence>\r\n            {latestAttack && (\r\n              <motion.div\r\n                key={latestAttack.id}\r\n                className={`atkFx atk-${latestAttack.anim_type}`}\r\n                initial={{ opacity: 0, scale: 0.95 }}\r\n                animate={{ opacity: 1, scale: 1 }}\r\n                exit={{ opacity: 0, scale: 1.05 }}\r\n                transition={{ duration: 0.35 }}\r\n              >\r\n                <div className=\"atkLabel\">\r\n                  {latestAttack.player_name} used <b>{latestAttack.move_name}</b>{\" \"}\r\n                  <span className={latestAttack.crit ? \"critTag\" : \"\"}>\r\n                    -{latestAttack.damage} {latestAttack.crit ? \"CRIT!\" : \"\"}\r\n                  </span>\r\n                </div>\r\n              </motion.div>\r\n            )}\r\n          </AnimatePresence>\r\n\r\n          {/* PLAYER HUD */}\r\n          <div className=\"hud playerHud\">\r\n            <div className=\"hudTop\">\r\n              <div>\r\n                <div className=\"hudTitle\">{player?.display_name ?? \"You\"}</div>\r\n                <div className=\"hudSub\">ENERGY</div>\r\n              </div>\r\n\r\n              <div className=\"hudSub\">Players: {players.length}</div>\r\n            </div>\r\n\r\n            <div className=\"hpRow\">\r\n              <span className=\"hpLabel\">EN</span>\r\n\r\n              <div className=\"hpOuter\">\r\n                <div\r\n                  className=\"hpInner\"\r\n                  style={{\r\n                    width: `${clamp(localEnergy, 0, 100)}%`,\r\n                    background: \"#8b5cf6\",\r\n                  }}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"hudSub\" style={{ marginTop: 10 }}>\r\n              Choose 1 of 4 random attacks\r\n            </div>\r\n\r\n            <div className=\"moveGrid\">\r\n              {moves.map((m) => (\r\n                <button\r\n                  key={m.id}\r\n                  className=\"moveBtn\"\r\n                  onClick={() => doMove(m)}\r\n                  disabled={!player || localEnergy < m.cost || raid?.status !== \"live\"}\r\n                  title={`Cost ${m.cost} | Dmg ${m.minDmg}-${m.maxDmg}`}\r\n                >\r\n                  <div className=\"moveName\">{m.name}</div>\r\n\r\n                  <div className=\"moveMeta\">\r\n                    <span>Cost {m.cost}</span>\r\n                    <span>\r\n                      Dmg {m.minDmg}-{m.maxDmg}\r\n                    </span>\r\n                  </div>\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* RIGHT ‚Äî LIVE ATTACKS */}\r\n      <div className=\"card cardCol\">\r\n        <h3 style={{ marginTop: 0 }}>Live Attacks</h3>\r\n\r\n        <div className=\"attackFeed\">\r\n          {attacksDeduped.slice(0, 200).map((a: any) => (\r\n            <div key={`${a.id}-${a.created_at ?? \"\"}`} className=\"attackRow\">\r\n              <div className=\"attackName\">{a.player_name}</div>\r\n              <div className=\"attackMove\">{a.move_name}</div>\r\n              <div className={`attackDmg ${a.crit ? \"crit\" : \"\"}`}>-{a.damage}</div>\r\n            </div>\r\n          ))}\r\n\r\n          {attacksDeduped.length === 0 && <div className=\"muted\">No attacks yet.</div>}\r\n        </div>\r\n\r\n        <div style={{ marginTop: 12 }} className=\"muted\">\r\n          Room: <b>{code}</b> ‚Äî Boss HP updates live.\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1205, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nisch/Desktop/pizza-raid/src/components/Leaderboard.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useMemo } from \"react\";\r\n\r\nexport default function Leaderboard({ raid, players }: { raid: any; players: any[] }) {\r\n  const total = useMemo(() => players.reduce((s, p) => s + (p.total_damage || 0), 0), [players]);\r\n\r\n  function rewardUnits(dmg: number) {\r\n    if (total <= 0) return 0;\r\n    return Math.round((100 * dmg) / total);\r\n  }\r\n\r\n  return (\r\n    <div className=\"card\">\r\n      <h2 style={{ marginTop: 0 }}>üèÜ Leaderboard</h2>\r\n      <div style={{ opacity: 0.8, marginBottom: 12 }}>\r\n        Boss: <b>{raid?.boss_name}</b> ‚Äî Result: <b>{raid?.boss_hp === 0 ? \"DEFEATED\" : \"TIME UP\"}</b>\r\n      </div>\r\n\r\n      <div className=\"leaderboard\">\r\n        <div className=\"lbHead\">\r\n          <div>#</div>\r\n          <div>Player</div>\r\n          <div>Damage</div>\r\n          <div>Reward</div>\r\n        </div>\r\n\r\n        {players.map((p, idx) => (\r\n          <div className=\"lbRow\" key={p.id}>\r\n            <div className=\"lbRank\">{idx + 1}</div>\r\n            <div className=\"lbName\">{p.display_name}</div>\r\n            <div className=\"lbDmg\">{p.total_damage}</div>\r\n            <div className=\"lbReward\">{rewardUnits(p.total_damage)} / 100</div>\r\n          </div>\r\n        ))}\r\n\r\n        {players.length === 0 && <div className=\"muted\">No players.</div>}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;;;AAFA;;AAIe,SAAS,YAAY,EAAE,IAAI,EAAE,OAAO,EAAiC;;IAClF,MAAM,QAAQ,IAAA,wKAAO;sCAAC,IAAM,QAAQ,MAAM;8CAAC,CAAC,GAAG,IAAM,IAAI,CAAC,EAAE,YAAY,IAAI,CAAC;6CAAG;qCAAI;QAAC;KAAQ;IAE7F,SAAS,YAAY,GAAW;QAC9B,IAAI,SAAS,GAAG,OAAO;QACvB,OAAO,KAAK,KAAK,CAAC,AAAC,MAAM,MAAO;IAClC;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAG,OAAO;oBAAE,WAAW;gBAAE;0BAAG;;;;;;0BAC7B,6LAAC;gBAAI,OAAO;oBAAE,SAAS;oBAAK,cAAc;gBAAG;;oBAAG;kCACxC,6LAAC;kCAAG,MAAM;;;;;;oBAAc;kCAAW,6LAAC;kCAAG,MAAM,YAAY,IAAI,aAAa;;;;;;;;;;;;0BAGlF,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;0CAAI;;;;;;0CACL,6LAAC;0CAAI;;;;;;0CACL,6LAAC;0CAAI;;;;;;0CACL,6LAAC;0CAAI;;;;;;;;;;;;oBAGN,QAAQ,GAAG,CAAC,CAAC,GAAG,oBACf,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAI,WAAU;8CAAU,MAAM;;;;;;8CAC/B,6LAAC;oCAAI,WAAU;8CAAU,EAAE,YAAY;;;;;;8CACvC,6LAAC;oCAAI,WAAU;8CAAS,EAAE,YAAY;;;;;;8CACtC,6LAAC;oCAAI,WAAU;;wCAAY,YAAY,EAAE,YAAY;wCAAE;;;;;;;;2BAJ7B,EAAE,EAAE;;;;;oBAQjC,QAAQ,MAAM,KAAK,mBAAK,6LAAC;wBAAI,WAAU;kCAAQ;;;;;;;;;;;;;;;;;;AAIxD;GApCwB;KAAA"}},
    {"offset": {"line": 1385, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nisch/Desktop/pizza-raid/src/app/raid/%5Bcode%5D/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useParams } from \"next/navigation\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { supabaseClient } from \"@/lib/supabaseClient\";\r\nimport { pickFourRandomMoves } from \"@/lib/moves\";\r\nimport Lobby from \"@/components/Lobby\";\r\nimport BattleArena from \"@/components/BattleArena\";\r\nimport Leaderboard from \"@/components/Leaderboard\";\r\n\r\ntype Mode = \"join\" | \"lobby\" | \"battle\" | \"ended\";\r\n\r\nexport default function RaidPage() {\r\n  const params = useParams<{ code: string }>();\r\n  const code = (params?.code ?? \"ENTER\").toString().toUpperCase();\r\n\r\n  const [mode, setMode] = useState<Mode>(\"join\");\r\n  const [raid, setRaid] = useState<any>(null);\r\n  const [player, setPlayer] = useState<any>(null);\r\n  const [players, setPlayers] = useState<any[]>([]);\r\n  const [attacks, setAttacks] = useState<any[]>([]);\r\n\r\n  const [moveSet, setMoveSet] = useState(() => pickFourRandomMoves());\r\n\r\n  // Load saved player for this raid (so refresh doesn't wipe identity)\r\n  useEffect(() => {\r\n    if (!code || code === \"ENTER\") return;\r\n\r\n    const saved = localStorage.getItem(`raid:${code}:player`);\r\n    if (saved) {\r\n      try {\r\n        setPlayer(JSON.parse(saved));\r\n      } catch {}\r\n    }\r\n  }, [code]);\r\n\r\n  async function refreshState() {\r\n    if (!code || code === \"ENTER\") return;\r\n\r\n    const res = await fetch(\"/api/raid/state\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ code }),\r\n    });\r\n\r\n    const json = await res.json();\r\n    if (json.error) return;\r\n\r\n    setRaid(json.raid);\r\n    setPlayers(json.players);\r\n    setAttacks(json.attacks);\r\n  }\r\n\r\n  // Initial fetch (guarded)\r\n  useEffect(() => {\r\n    if (!code || code === \"ENTER\") return;\r\n    refreshState();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [code]);\r\n\r\n  // Subscribe realtime once raid is known\r\n  useEffect(() => {\r\n    if (!raid?.id) return;\r\n\r\n    const channel = supabaseClient\r\n      .channel(`raid:${raid.id}`)\r\n      .on(\r\n        \"postgres_changes\",\r\n        { event: \"*\", schema: \"public\", table: \"raids\", filter: `id=eq.${raid.id}` },\r\n        (payload) => {\r\n          const next = payload.new as any;\r\n          setRaid((r: any) => ({ ...r, ...next }));\r\n        }\r\n      )\r\n      .on(\r\n        \"postgres_changes\",\r\n        { event: \"*\", schema: \"public\", table: \"players\", filter: `raid_id=eq.${raid.id}` },\r\n        async () => {\r\n          // Re-fetch ordered players for leaderboard correctness\r\n          const res = await fetch(\"/api/raid/state\", {\r\n            method: \"POST\",\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            body: JSON.stringify({ code }),\r\n          });\r\n          const json = await res.json();\r\n          if (!json.error) setPlayers(json.players);\r\n        }\r\n      )\r\n      .on(\r\n        \"postgres_changes\",\r\n        { event: \"INSERT\", schema: \"public\", table: \"attacks\", filter: `raid_id=eq.${raid.id}` },\r\n        (payload) => {\r\n          const atk = payload.new as any;\r\n          // prepend + cap\r\n          setAttacks((prev) => [atk, ...prev].slice(0, 200));\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabaseClient.removeChannel(channel);\r\n    };\r\n  }, [raid?.id, code]);\r\n\r\n  async function joinRaid(firstName: string, lastName: string, tag: string) {\r\n    const res = await fetch(\"/api/raid/join\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ code, firstName, lastName, tag }),\r\n    });\r\n    const json = await res.json();\r\n    if (json.error) return alert(json.error);\r\n\r\n    setRaid(json.raid);\r\n    setPlayer(json.player);\r\n    localStorage.setItem(`raid:${code}:player`, JSON.stringify(json.player));\r\n    setMode(\"lobby\");\r\n\r\n    await refreshState();\r\n  }\r\n\r\n  async function doAttack(moveId: number) {\r\n    if (!player) return alert(\"Join first.\");\r\n\r\n    const res = await fetch(\"/api/raid/attack\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ code, playerId: player.id, moveId }),\r\n    });\r\n    const json = await res.json();\r\n    if (json.error) return;\r\n\r\n    await refreshState();\r\n    setMoveSet(pickFourRandomMoves());\r\n  }\r\n\r\n  // Single source of truth for mode switching (PLAYER PAGE ONLY)\r\n  useEffect(() => {\r\n    if (!raid) return;\r\n\r\n    if (raid.status === \"lobby\") setMode(player ? \"lobby\" : \"join\");\r\n    if (raid.status === \"live\") setMode(\"battle\");\r\n    if (raid.status === \"ended\") setMode(\"ended\");\r\n  }, [raid, player]);\r\n\r\n  return (\r\n    <main className=\"pageShell\">\r\n      <div className=\"raidTop\">\r\n        <div>\r\n          <div className=\"raidTitle\">üççüçï Room {code}</div>\r\n          {raid && (\r\n            <div className=\"raidSub\">\r\n              Boss: <b>{raid.boss_name}</b> ‚Äî Status: <b>{raid.status}</b>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"raidRight\">\r\n          <button\r\n            className=\"btn\"\r\n            onClick={() => {\r\n              if (code !== \"ENTER\") refreshState();\r\n            }}\r\n          >\r\n            Refresh\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {mode === \"join\" && (\r\n        <Lobby\r\n          mode=\"join\"\r\n          code={code}\r\n          raid={raid}\r\n          player={player}\r\n          players={players}\r\n          onJoin={joinRaid}\r\n        />\r\n      )}\r\n\r\n      {mode === \"lobby\" && (\r\n        <Lobby\r\n          mode=\"lobby\"\r\n          code={code}\r\n          raid={raid}\r\n          player={player}\r\n          players={players}\r\n          onJoin={joinRaid}\r\n        />\r\n      )}\r\n\r\n      {mode === \"battle\" && (\r\n        <BattleArena\r\n          code={code}\r\n          raid={raid}\r\n          player={player}\r\n          players={players}\r\n          attacks={attacks}\r\n          moves={moveSet}\r\n          onAttack={doAttack}\r\n        />\r\n      )}\r\n\r\n      {mode === \"ended\" && <Leaderboard raid={raid} players={players} />}\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AARA;;;;;;;;AAYe,SAAS;;IACtB,MAAM,SAAS,IAAA,kJAAS;IACxB,MAAM,OAAO,CAAC,QAAQ,QAAQ,OAAO,EAAE,QAAQ,GAAG,WAAW;IAE7D,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAO;IACvC,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAM;IACtC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAM;IAC1C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAQ,EAAE;IAChD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAQ,EAAE;IAEhD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ;6BAAC,IAAM,IAAA,6IAAmB;;IAEhE,qEAAqE;IACrE,IAAA,0KAAS;8BAAC;YACR,IAAI,CAAC,QAAQ,SAAS,SAAS;YAE/B,MAAM,QAAQ,aAAa,OAAO,CAAC,CAAC,KAAK,EAAE,KAAK,OAAO,CAAC;YACxD,IAAI,OAAO;gBACT,IAAI;oBACF,UAAU,KAAK,KAAK,CAAC;gBACvB,EAAE,OAAM,CAAC;YACX;QACF;6BAAG;QAAC;KAAK;IAET,eAAe;QACb,IAAI,CAAC,QAAQ,SAAS,SAAS;QAE/B,MAAM,MAAM,MAAM,MAAM,mBAAmB;YACzC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE;YAAK;QAC9B;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,IAAI,KAAK,KAAK,EAAE;QAEhB,QAAQ,KAAK,IAAI;QACjB,WAAW,KAAK,OAAO;QACvB,WAAW,KAAK,OAAO;IACzB;IAEA,0BAA0B;IAC1B,IAAA,0KAAS;8BAAC;YACR,IAAI,CAAC,QAAQ,SAAS,SAAS;YAC/B;QACA,uDAAuD;QACzD;6BAAG;QAAC;KAAK;IAET,wCAAwC;IACxC,IAAA,0KAAS;8BAAC;YACR,IAAI,CAAC,MAAM,IAAI;YAEf,MAAM,UAAU,iJAAc,CAC3B,OAAO,CAAC,CAAC,KAAK,EAAE,KAAK,EAAE,EAAE,EACzB,EAAE,CACD,oBACA;gBAAE,OAAO;gBAAK,QAAQ;gBAAU,OAAO;gBAAS,QAAQ,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE;YAAC;8CAC3E,CAAC;oBACC,MAAM,OAAO,QAAQ,GAAG;oBACxB;sDAAQ,CAAC,IAAW,CAAC;gCAAE,GAAG,CAAC;gCAAE,GAAG,IAAI;4BAAC,CAAC;;gBACxC;6CAED,EAAE,CACD,oBACA;gBAAE,OAAO;gBAAK,QAAQ;gBAAU,OAAO;gBAAW,QAAQ,CAAC,WAAW,EAAE,KAAK,EAAE,EAAE;YAAC;8CAClF;oBACE,uDAAuD;oBACvD,MAAM,MAAM,MAAM,MAAM,mBAAmB;wBACzC,QAAQ;wBACR,SAAS;4BAAE,gBAAgB;wBAAmB;wBAC9C,MAAM,KAAK,SAAS,CAAC;4BAAE;wBAAK;oBAC9B;oBACA,MAAM,OAAO,MAAM,IAAI,IAAI;oBAC3B,IAAI,CAAC,KAAK,KAAK,EAAE,WAAW,KAAK,OAAO;gBAC1C;6CAED,EAAE,CACD,oBACA;gBAAE,OAAO;gBAAU,QAAQ;gBAAU,OAAO;gBAAW,QAAQ,CAAC,WAAW,EAAE,KAAK,EAAE,EAAE;YAAC;8CACvF,CAAC;oBACC,MAAM,MAAM,QAAQ,GAAG;oBACvB,gBAAgB;oBAChB;sDAAW,CAAC,OAAS;gCAAC;mCAAQ;6BAAK,CAAC,KAAK,CAAC,GAAG;;gBAC/C;6CAED,SAAS;YAEZ;sCAAO;oBACL,iJAAc,CAAC,aAAa,CAAC;gBAC/B;;QACF;6BAAG;QAAC,MAAM;QAAI;KAAK;IAEnB,eAAe,SAAS,SAAiB,EAAE,QAAgB,EAAE,GAAW;QACtE,MAAM,MAAM,MAAM,MAAM,kBAAkB;YACxC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAM;gBAAW;gBAAU;YAAI;QACxD;QACA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,IAAI,KAAK,KAAK,EAAE,OAAO,MAAM,KAAK,KAAK;QAEvC,QAAQ,KAAK,IAAI;QACjB,UAAU,KAAK,MAAM;QACrB,aAAa,OAAO,CAAC,CAAC,KAAK,EAAE,KAAK,OAAO,CAAC,EAAE,KAAK,SAAS,CAAC,KAAK,MAAM;QACtE,QAAQ;QAER,MAAM;IACR;IAEA,eAAe,SAAS,MAAc;QACpC,IAAI,CAAC,QAAQ,OAAO,MAAM;QAE1B,MAAM,MAAM,MAAM,MAAM,oBAAoB;YAC1C,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE;gBAAM,UAAU,OAAO,EAAE;gBAAE;YAAO;QAC3D;QACA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,IAAI,KAAK,KAAK,EAAE;QAEhB,MAAM;QACN,WAAW,IAAA,6IAAmB;IAChC;IAEA,+DAA+D;IAC/D,IAAA,0KAAS;8BAAC;YACR,IAAI,CAAC,MAAM;YAEX,IAAI,KAAK,MAAM,KAAK,SAAS,QAAQ,SAAS,UAAU;YACxD,IAAI,KAAK,MAAM,KAAK,QAAQ,QAAQ;YACpC,IAAI,KAAK,MAAM,KAAK,SAAS,QAAQ;QACvC;6BAAG;QAAC;QAAM;KAAO;IAEjB,qBACE,6LAAC;QAAK,WAAU;;0BACd,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;;0CACC,6LAAC;gCAAI,WAAU;;oCAAY;oCAAW;;;;;;;4BACrC,sBACC,6LAAC;gCAAI,WAAU;;oCAAU;kDACjB,6LAAC;kDAAG,KAAK,SAAS;;;;;;oCAAK;kDAAW,6LAAC;kDAAG,KAAK,MAAM;;;;;;;;;;;;;;;;;;kCAK7D,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BACC,WAAU;4BACV,SAAS;gCACP,IAAI,SAAS,SAAS;4BACxB;sCACD;;;;;;;;;;;;;;;;;YAMJ,SAAS,wBACR,6LAAC,yIAAK;gBACJ,MAAK;gBACL,MAAM;gBACN,MAAM;gBACN,QAAQ;gBACR,SAAS;gBACT,QAAQ;;;;;;YAIX,SAAS,yBACR,6LAAC,yIAAK;gBACJ,MAAK;gBACL,MAAM;gBACN,MAAM;gBACN,QAAQ;gBACR,SAAS;gBACT,QAAQ;;;;;;YAIX,SAAS,0BACR,6LAAC,+IAAW;gBACV,MAAM;gBACN,MAAM;gBACN,QAAQ;gBACR,SAAS;gBACT,SAAS;gBACT,OAAO;gBACP,UAAU;;;;;;YAIb,SAAS,yBAAW,6LAAC,+IAAW;gBAAC,MAAM;gBAAM,SAAS;;;;;;;;;;;;AAG7D;GAlMwB;;QACP,kJAAS;;;KADF"}}]
}