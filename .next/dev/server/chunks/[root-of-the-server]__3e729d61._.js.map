{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nisch/Desktop/pizza-raid/src/lib/supabaseServer.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\r\n\r\nexport function supabaseServer() {\r\n  return createClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.SUPABASE_SERVICE_ROLE_KEY!,\r\n    {\r\n      auth: { persistSession: false },\r\n    }\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,SAAS;IACd,OAAO,IAAA,gMAAY,gFAEjB,QAAQ,GAAG,CAAC,yBAAyB,EACrC;QACE,MAAM;YAAE,gBAAgB;QAAM;IAChC;AAEJ"}},
    {"offset": {"line": 63, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nisch/Desktop/pizza-raid/src/lib/utils.ts"],"sourcesContent":["export function nowMs() {\r\n  return Date.now();\r\n}\r\n\r\nexport function clamp(n: number, a: number, b: number) {\r\n  return Math.max(a, Math.min(b, n));\r\n}\r\n\r\nexport function isFiveDigits(tag: string) {\r\n  return /^[0-9]{5}$/.test(tag);\r\n}\r\n\r\nexport function cleanName(s: string) {\r\n  return s.trim().replace(/\\s+/g, \" \");\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAO,SAAS;IACd,OAAO,KAAK,GAAG;AACjB;AAEO,SAAS,MAAM,CAAS,EAAE,CAAS,EAAE,CAAS;IACnD,OAAO,KAAK,GAAG,CAAC,GAAG,KAAK,GAAG,CAAC,GAAG;AACjC;AAEO,SAAS,aAAa,GAAW;IACtC,OAAO,aAAa,IAAI,CAAC;AAC3B;AAEO,SAAS,UAAU,CAAS;IACjC,OAAO,EAAE,IAAI,GAAG,OAAO,CAAC,QAAQ;AAClC"}},
    {"offset": {"line": 89, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nisch/Desktop/pizza-raid/src/lib/moves.ts"],"sourcesContent":["export type Move = {\r\n  id: number;\r\n  name: string;\r\n  cost: number;       // 0..100\r\n  minDmg: number;\r\n  maxDmg: number;\r\n  critChance: number; // 0..1\r\n  animType: \"slash\" | \"fire\" | \"zap\" | \"bite\" | \"meteor\" | \"wave\" | \"spin\" | \"beam\";\r\n};\r\n\r\nexport const MOVES: Move[] = [\r\n  { id: 1,  name: \"Crust Cutter\",      cost: 18, minDmg: 18, maxDmg: 28, critChance: 0.12, animType: \"slash\" },\r\n  { id: 2,  name: \"Sauce Splash\",      cost: 14, minDmg: 12, maxDmg: 22, critChance: 0.10, animType: \"wave\" },\r\n  { id: 3,  name: \"Pineapple Pop\",     cost: 22, minDmg: 20, maxDmg: 34, critChance: 0.13, animType: \"spin\" },\r\n  { id: 4,  name: \"Cheese Melt\",       cost: 16, minDmg: 14, maxDmg: 26, critChance: 0.11, animType: \"wave\" },\r\n\r\n  { id: 5,  name: \"Pepperoni Pummel\",  cost: 26, minDmg: 26, maxDmg: 40, critChance: 0.14, animType: \"bite\" },\r\n  { id: 6,  name: \"Oven Blast\",        cost: 30, minDmg: 30, maxDmg: 46, critChance: 0.15, animType: \"fire\" },\r\n  { id: 7,  name: \"Neon Zest\",         cost: 20, minDmg: 18, maxDmg: 30, critChance: 0.12, animType: \"zap\" },\r\n  { id: 8,  name: \"Garlic Grenade\",    cost: 28, minDmg: 28, maxDmg: 44, critChance: 0.15, animType: \"meteor\" },\r\n\r\n  { id: 9,  name: \"Slice Spiral\",      cost: 12, minDmg: 10, maxDmg: 18, critChance: 0.08, animType: \"spin\" },\r\n  { id: 10, name: \"Anchovy Beam\",      cost: 34, minDmg: 34, maxDmg: 52, critChance: 0.16, animType: \"beam\" },\r\n  { id: 11, name: \"Dough Dropkick\",    cost: 24, minDmg: 22, maxDmg: 36, critChance: 0.13, animType: \"slash\" },\r\n  { id: 12, name: \"Basil Barrage\",     cost: 18, minDmg: 16, maxDmg: 28, critChance: 0.11, animType: \"wave\" },\r\n\r\n  { id: 13, name: \"Mozzarella Meteor\", cost: 40, minDmg: 44, maxDmg: 70, critChance: 0.18, animType: \"meteor\" },\r\n  { id: 14, name: \"Hot Honey Hex\",     cost: 32, minDmg: 32, maxDmg: 50, critChance: 0.16, animType: \"fire\" },\r\n  { id: 15, name: \"Carbonated Zap\",    cost: 22, minDmg: 20, maxDmg: 34, critChance: 0.13, animType: \"zap\" },\r\n  { id: 16, name: \"Final Slice\",       cost: 45, minDmg: 55, maxDmg: 85, critChance: 0.20, animType: \"beam\" },\r\n];\r\n\r\nexport function pickFourRandomMoves(): Move[] {\r\n  const copy = [...MOVES];\r\n  // Fisher-Yates shuffle partial\r\n  for (let i = copy.length - 1; i > 0; i--) {\r\n    const j = Math.floor(Math.random() * (i + 1));\r\n    [copy[i], copy[j]] = [copy[j], copy[i]];\r\n  }\r\n  return copy.slice(0, 4);\r\n}\r\n\r\nexport function getMoveById(id: number): Move | undefined {\r\n  return MOVES.find((m) => m.id === id);\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAUO,MAAM,QAAgB;IAC3B;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAQ;IAC3G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;IAC1G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;IAC1G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;IAE1G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;IAC1G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;IAC1G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAM;IACzG;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAS;IAE5G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;IAC1G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;IAC1G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAQ;IAC3G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;IAE1G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAS;IAC5G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;IAC1G;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAM;IACzG;QAAE,IAAI;QAAI,MAAM;QAAqB,MAAM;QAAI,QAAQ;QAAI,QAAQ;QAAI,YAAY;QAAM,UAAU;IAAO;CAC3G;AAEM,SAAS;IACd,MAAM,OAAO;WAAI;KAAM;IACvB,+BAA+B;IAC/B,IAAK,IAAI,IAAI,KAAK,MAAM,GAAG,GAAG,IAAI,GAAG,IAAK;QACxC,MAAM,IAAI,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,CAAC,IAAI,CAAC;QAC3C,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,EAAE,CAAC,GAAG;YAAC,IAAI,CAAC,EAAE;YAAE,IAAI,CAAC,EAAE;SAAC;IACzC;IACA,OAAO,KAAK,KAAK,CAAC,GAAG;AACvB;AAEO,SAAS,YAAY,EAAU;IACpC,OAAO,MAAM,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;AACpC"}},
    {"offset": {"line": 264, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nisch/Desktop/pizza-raid/src/app/api/raid/attack/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { supabaseServer } from \"@/lib/supabaseServer\";\r\nimport { clamp } from \"@/lib/utils\";\r\nimport { getMoveById } from \"@/lib/moves\";\r\n\r\nconst ENERGY_MAX = 100;\r\nconst ENERGY_REGEN_PER_SEC = 25; // 0->100 in 4 seconds\r\nconst CRIT_MULT = 1.2;\r\n\r\nexport async function POST(req: Request) {\r\n  const sb = supabaseServer();\r\n  const body = await req.json();\r\n\r\n  const raidCode = String(body.code || \"\").toUpperCase().trim();\r\n  const playerId = String(body.playerId || \"\").trim();\r\n  const moveId = Number(body.moveId);\r\n\r\n  if (!raidCode || !playerId || !Number.isFinite(moveId)) {\r\n    return NextResponse.json({ error: \"Invalid attack payload.\" }, { status: 400 });\r\n  }\r\n\r\n  const move = getMoveById(moveId);\r\n  if (!move) return NextResponse.json({ error: \"Invalid move.\" }, { status: 400 });\r\n\r\n  // Load raid\r\n  const { data: raid, error: raidErr } = await sb\r\n    .from(\"raids\")\r\n    .select(\"*\")\r\n    .eq(\"code\", raidCode)\r\n    .single();\r\n\r\n  if (raidErr || !raid) return NextResponse.json({ error: \"Raid not found.\" }, { status: 404 });\r\n  if (raid.status !== \"live\") return NextResponse.json({ error: \"Raid not live.\" }, { status: 409 });\r\n\r\n  const now = new Date();\r\n\r\n  // End check\r\n  if (raid.ends_at && now.getTime() > new Date(raid.ends_at).getTime()) {\r\n    // auto end\r\n    await sb.from(\"raids\").update({ status: \"ended\" }).eq(\"id\", raid.id);\r\n    return NextResponse.json({ error: \"Raid ended.\" }, { status: 409 });\r\n  }\r\n\r\n  // Load player\r\n  const { data: player, error: pErr } = await sb\r\n    .from(\"players\")\r\n    .select(\"*\")\r\n    .eq(\"id\", playerId)\r\n    .eq(\"raid_id\", raid.id)\r\n    .single();\r\n\r\n  if (pErr || !player) return NextResponse.json({ error: \"Player not found.\" }, { status: 404 });\r\n\r\n  // Compute regenerated energy\r\n  const prevTs = new Date(player.energy_updated_at).getTime();\r\n  const dtSec = Math.max(0, (now.getTime() - prevTs) / 1000);\r\n  const regen = Math.floor(dtSec * ENERGY_REGEN_PER_SEC);\r\n  const currentEnergy = clamp(player.energy + regen, 0, ENERGY_MAX);\r\n\r\n  if (currentEnergy < move.cost) {\r\n    return NextResponse.json({ error: \"Not enough energy.\" }, { status: 429 });\r\n  }\r\n\r\n  // Roll damage + crit\r\n  const base = Math.floor(Math.random() * (move.maxDmg - move.minDmg + 1)) + move.minDmg;\r\n  const crit = Math.random() < move.critChance;\r\n  const dmg = crit ? Math.floor(base * CRIT_MULT) : base;\r\n\r\n  const newEnergy = currentEnergy - move.cost;\r\n\r\n  // Apply updates (simple sequential updates; good enough for v1)\r\n  const newBossHp = Math.max(0, raid.boss_hp - dmg);\r\n\r\n  const { error: attackErr } = await sb.from(\"attacks\").insert({\r\n    raid_id: raid.id,\r\n    player_id: player.id,\r\n    player_name: player.display_name,\r\n    move_id: move.id,\r\n    move_name: move.name,\r\n    energy_cost: move.cost,\r\n    damage: dmg,\r\n    crit,\r\n    anim_type: move.animType,\r\n  });\r\n\r\n  if (attackErr) return NextResponse.json({ error: attackErr.message }, { status: 500 });\r\n\r\n  const { error: playerUpErr } = await sb\r\n    .from(\"players\")\r\n    .update({\r\n      total_damage: player.total_damage + dmg,\r\n      energy: newEnergy,\r\n      energy_updated_at: now.toISOString(),\r\n      last_attack_at: now.toISOString(),\r\n    })\r\n    .eq(\"id\", player.id);\r\n\r\n  if (playerUpErr) return NextResponse.json({ error: playerUpErr.message }, { status: 500 });\r\n\r\n  // Update raid HP + possibly end\r\n  const raidUpdate: any = { boss_hp: newBossHp };\r\n  if (newBossHp === 0) raidUpdate.status = \"ended\";\r\n\r\n  const { error: raidUpErr } = await sb.from(\"raids\").update(raidUpdate).eq(\"id\", raid.id);\r\n  if (raidUpErr) return NextResponse.json({ error: raidUpErr.message }, { status: 500 });\r\n\r\n  return NextResponse.json({\r\n    ok: true,\r\n    damage: dmg,\r\n    crit,\r\n    boss_hp: newBossHp,\r\n    energy: newEnergy,\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA,MAAM,aAAa;AACnB,MAAM,uBAAuB,IAAI,sBAAsB;AACvD,MAAM,YAAY;AAEX,eAAe,KAAK,GAAY;IACrC,MAAM,KAAK,IAAA,gJAAc;IACzB,MAAM,OAAO,MAAM,IAAI,IAAI;IAE3B,MAAM,WAAW,OAAO,KAAK,IAAI,IAAI,IAAI,WAAW,GAAG,IAAI;IAC3D,MAAM,WAAW,OAAO,KAAK,QAAQ,IAAI,IAAI,IAAI;IACjD,MAAM,SAAS,OAAO,KAAK,MAAM;IAEjC,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,OAAO,QAAQ,CAAC,SAAS;QACtD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA0B,GAAG;YAAE,QAAQ;QAAI;IAC/E;IAEA,MAAM,OAAO,IAAA,oIAAW,EAAC;IACzB,IAAI,CAAC,MAAM,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAgB,GAAG;QAAE,QAAQ;IAAI;IAE9E,YAAY;IACZ,MAAM,EAAE,MAAM,IAAI,EAAE,OAAO,OAAO,EAAE,GAAG,MAAM,GAC1C,IAAI,CAAC,SACL,MAAM,CAAC,KACP,EAAE,CAAC,QAAQ,UACX,MAAM;IAET,IAAI,WAAW,CAAC,MAAM,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAkB,GAAG;QAAE,QAAQ;IAAI;IAC3F,IAAI,KAAK,MAAM,KAAK,QAAQ,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAiB,GAAG;QAAE,QAAQ;IAAI;IAEhG,MAAM,MAAM,IAAI;IAEhB,YAAY;IACZ,IAAI,KAAK,OAAO,IAAI,IAAI,OAAO,KAAK,IAAI,KAAK,KAAK,OAAO,EAAE,OAAO,IAAI;QACpE,WAAW;QACX,MAAM,GAAG,IAAI,CAAC,SAAS,MAAM,CAAC;YAAE,QAAQ;QAAQ,GAAG,EAAE,CAAC,MAAM,KAAK,EAAE;QACnE,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAc,GAAG;YAAE,QAAQ;QAAI;IACnE;IAEA,cAAc;IACd,MAAM,EAAE,MAAM,MAAM,EAAE,OAAO,IAAI,EAAE,GAAG,MAAM,GACzC,IAAI,CAAC,WACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,UACT,EAAE,CAAC,WAAW,KAAK,EAAE,EACrB,MAAM;IAET,IAAI,QAAQ,CAAC,QAAQ,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAoB,GAAG;QAAE,QAAQ;IAAI;IAE5F,6BAA6B;IAC7B,MAAM,SAAS,IAAI,KAAK,OAAO,iBAAiB,EAAE,OAAO;IACzD,MAAM,QAAQ,KAAK,GAAG,CAAC,GAAG,CAAC,IAAI,OAAO,KAAK,MAAM,IAAI;IACrD,MAAM,QAAQ,KAAK,KAAK,CAAC,QAAQ;IACjC,MAAM,gBAAgB,IAAA,8HAAK,EAAC,OAAO,MAAM,GAAG,OAAO,GAAG;IAEtD,IAAI,gBAAgB,KAAK,IAAI,EAAE;QAC7B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAqB,GAAG;YAAE,QAAQ;QAAI;IAC1E;IAEA,qBAAqB;IACrB,MAAM,OAAO,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,CAAC,KAAK,MAAM,GAAG,KAAK,MAAM,GAAG,CAAC,KAAK,KAAK,MAAM;IACtF,MAAM,OAAO,KAAK,MAAM,KAAK,KAAK,UAAU;IAC5C,MAAM,MAAM,OAAO,KAAK,KAAK,CAAC,OAAO,aAAa;IAElD,MAAM,YAAY,gBAAgB,KAAK,IAAI;IAE3C,gEAAgE;IAChE,MAAM,YAAY,KAAK,GAAG,CAAC,GAAG,KAAK,OAAO,GAAG;IAE7C,MAAM,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,GAAG,IAAI,CAAC,WAAW,MAAM,CAAC;QAC3D,SAAS,KAAK,EAAE;QAChB,WAAW,OAAO,EAAE;QACpB,aAAa,OAAO,YAAY;QAChC,SAAS,KAAK,EAAE;QAChB,WAAW,KAAK,IAAI;QACpB,aAAa,KAAK,IAAI;QACtB,QAAQ;QACR;QACA,WAAW,KAAK,QAAQ;IAC1B;IAEA,IAAI,WAAW,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO,UAAU,OAAO;IAAC,GAAG;QAAE,QAAQ;IAAI;IAEpF,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,GAClC,IAAI,CAAC,WACL,MAAM,CAAC;QACN,cAAc,OAAO,YAAY,GAAG;QACpC,QAAQ;QACR,mBAAmB,IAAI,WAAW;QAClC,gBAAgB,IAAI,WAAW;IACjC,GACC,EAAE,CAAC,MAAM,OAAO,EAAE;IAErB,IAAI,aAAa,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO,YAAY,OAAO;IAAC,GAAG;QAAE,QAAQ;IAAI;IAExF,gCAAgC;IAChC,MAAM,aAAkB;QAAE,SAAS;IAAU;IAC7C,IAAI,cAAc,GAAG,WAAW,MAAM,GAAG;IAEzC,MAAM,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,GAAG,IAAI,CAAC,SAAS,MAAM,CAAC,YAAY,EAAE,CAAC,MAAM,KAAK,EAAE;IACvF,IAAI,WAAW,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO,UAAU,OAAO;IAAC,GAAG;QAAE,QAAQ;IAAI;IAEpF,OAAO,gJAAY,CAAC,IAAI,CAAC;QACvB,IAAI;QACJ,QAAQ;QACR;QACA,SAAS;QACT,QAAQ;IACV;AACF"}}]
}