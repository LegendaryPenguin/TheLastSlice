{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nisch/Desktop/pizza-raid/src/lib/supabaseClient.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\r\n\r\nexport const supabaseClient = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n);\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,iBAAiB,IAAA,8LAAY"}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nisch/Desktop/pizza-raid/src/app/host/%5Bcode%5D/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useParams } from \"next/navigation\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { supabaseClient } from \"@/lib/supabaseClient\";\r\n\r\nexport default function HostLobbyPage() {\r\n  const params = useParams<{ code: string }>();\r\n  const code = (params?.code ?? \"ENTER\").toString().toUpperCase();\r\n\r\n  const [raid, setRaid] = useState<any>(null);\r\n  const [players, setPlayers] = useState<any[]>([]);\r\n  const [loadingStart, setLoadingStart] = useState(false);\r\n\r\n  async function refreshState() {\r\n    if (!code || code === \"ENTER\") return;\r\n\r\n    const res = await fetch(\"/api/raid/state\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ code }),\r\n    });\r\n\r\n    const json = await res.json();\r\n    if (json?.error) return;\r\n\r\n    setRaid(json.raid);\r\n    setPlayers(json.players || []);\r\n  }\r\n\r\n  // initial load\r\n  useEffect(() => {\r\n    refreshState();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [code]);\r\n\r\n  // realtime subscribe\r\n  useEffect(() => {\r\n    if (!raid?.id) return;\r\n\r\n    const channel = supabaseClient\r\n      .channel(`host:${raid.id}`)\r\n      .on(\r\n        \"postgres_changes\",\r\n        { event: \"*\", schema: \"public\", table: \"raids\", filter: `id=eq.${raid.id}` },\r\n        (payload) => {\r\n          const next = payload.new as any;\r\n          setRaid((r: any) => ({ ...r, ...next }));\r\n        }\r\n      )\r\n      .on(\r\n        \"postgres_changes\",\r\n        { event: \"*\", schema: \"public\", table: \"players\", filter: `raid_id=eq.${raid.id}` },\r\n        () => refreshState()\r\n      )\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabaseClient.removeChannel(channel);\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [raid?.id]);\r\n\r\n  async function startRaid() {\r\n    if (!raid || raid.status !== \"lobby\") return;\r\n    setLoadingStart(true);\r\n    try {\r\n      const res = await fetch(\"/api/raid/start\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ code }),\r\n      });\r\n      const json = await res.json();\r\n      if (json?.error) alert(json.error);\r\n      await refreshState();\r\n    } finally {\r\n      setLoadingStart(false);\r\n    }\r\n  }\r\n\r\n  const shareUrl =\r\n    typeof window === \"undefined\" ? \"\" : `${window.location.origin}/raid/${code}`;\r\n\r\n  return (\r\n    <main className=\"pageShell\">\r\n      <div className=\"raidTop\">\r\n        <div>\r\n          <div className=\"raidTitle\">üéõÔ∏è Host Lobby ‚Äî Room {code}</div>\r\n          {raid && (\r\n            <div className=\"raidSub\">\r\n              Boss: <b>{raid.boss_name}</b> ‚Äî Status: <b>{raid.status}</b>\r\n            </div>\r\n          )}\r\n          {shareUrl && (\r\n            <div className=\"raidSub\" style={{ marginTop: 6 }}>\r\n              Share: <b style={{ wordBreak: \"break-all\" }}>{shareUrl}</b>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"raidRight\">\r\n          <button className=\"btn\" onClick={refreshState}>\r\n            Refresh\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid2\">\r\n        <div className=\"card\">\r\n          <h2 style={{ marginTop: 0 }}>Controls</h2>\r\n\r\n          <div className=\"pill\">\r\n            <div style={{ fontWeight: 900, marginBottom: 6 }}>Room Code</div>\r\n            <div style={{ fontSize: 22 }}>\r\n              <b>{code}</b>\r\n            </div>\r\n          </div>\r\n\r\n          <div style={{ marginTop: 14, display: \"flex\", gap: 10, alignItems: \"center\", flexWrap: \"wrap\" }}>\r\n            <button\r\n              className=\"btnPrimary\"\r\n              onClick={startRaid}\r\n              disabled={!raid || raid?.status !== \"lobby\" || players.length < 1 || loadingStart}\r\n              title=\"Start when ready\"\r\n            >\r\n              {loadingStart ? \"Starting...\" : \"Start Raid\"}\r\n            </button>\r\n\r\n            <span style={{ opacity: 0.75, fontSize: 12 }}>\r\n              Players joined: <b>{players.length}</b>\r\n            </span>\r\n          </div>\r\n\r\n          <div style={{ opacity: 0.7, fontSize: 12, marginTop: 10 }}>\r\n            Tip: keep this tab on the projector. Players join from the share link. When you press Start, everyone switches to battle automatically.\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"card\">\r\n          <h3 style={{ marginTop: 0 }}>Players</h3>\r\n          <div className=\"list\">\r\n            {players.map((p) => (\r\n              <div key={p.id} className=\"row\">\r\n                <div className=\"name\">{p.display_name}</div>\r\n                <div className=\"muted\">DMG {p.total_damage}</div>\r\n              </div>\r\n            ))}\r\n            {players.length === 0 && <div className=\"muted\">No one joined yet.</div>}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAMe,SAAS;IACtB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,OAAO,CAAC,QAAQ,QAAQ,OAAO,EAAE,QAAQ,GAAG,WAAW;IAE7D,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAM;IACtC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAQ,EAAE;IAChD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IAEjD,eAAe;QACb,IAAI,CAAC,QAAQ,SAAS,SAAS;QAE/B,MAAM,MAAM,MAAM,MAAM,mBAAmB;YACzC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE;YAAK;QAC9B;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,IAAI,MAAM,OAAO;QAEjB,QAAQ,KAAK,IAAI;QACjB,WAAW,KAAK,OAAO,IAAI,EAAE;IAC/B;IAEA,eAAe;IACf,IAAA,kNAAS,EAAC;QACR;IACA,uDAAuD;IACzD,GAAG;QAAC;KAAK;IAET,qBAAqB;IACrB,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,MAAM,IAAI;QAEf,MAAM,UAAU,8IAAc,CAC3B,OAAO,CAAC,CAAC,KAAK,EAAE,KAAK,EAAE,EAAE,EACzB,EAAE,CACD,oBACA;YAAE,OAAO;YAAK,QAAQ;YAAU,OAAO;YAAS,QAAQ,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE;QAAC,GAC3E,CAAC;YACC,MAAM,OAAO,QAAQ,GAAG;YACxB,QAAQ,CAAC,IAAW,CAAC;oBAAE,GAAG,CAAC;oBAAE,GAAG,IAAI;gBAAC,CAAC;QACxC,GAED,EAAE,CACD,oBACA;YAAE,OAAO;YAAK,QAAQ;YAAU,OAAO;YAAW,QAAQ,CAAC,WAAW,EAAE,KAAK,EAAE,EAAE;QAAC,GAClF,IAAM,gBAEP,SAAS;QAEZ,OAAO;YACL,8IAAc,CAAC,aAAa,CAAC;QAC/B;IACA,uDAAuD;IACzD,GAAG;QAAC,MAAM;KAAG;IAEb,eAAe;QACb,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,SAAS;QACtC,gBAAgB;QAChB,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,mBAAmB;gBACzC,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE;gBAAK;YAC9B;YACA,MAAM,OAAO,MAAM,IAAI,IAAI;YAC3B,IAAI,MAAM,OAAO,MAAM,KAAK,KAAK;YACjC,MAAM;QACR,SAAU;YACR,gBAAgB;QAClB;IACF;IAEA,MAAM,WACJ,uCAAgC,KAAK;IAEvC,qBACE,8OAAC;QAAK,WAAU;;0BACd,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;;0CACC,8OAAC;gCAAI,WAAU;;oCAAY;oCAAuB;;;;;;;4BACjD,sBACC,8OAAC;gCAAI,WAAU;;oCAAU;kDACjB,8OAAC;kDAAG,KAAK,SAAS;;;;;;oCAAK;kDAAW,8OAAC;kDAAG,KAAK,MAAM;;;;;;;;;;;;4BAG1D,0BACC,8OAAC;gCAAI,WAAU;gCAAU,OAAO;oCAAE,WAAW;gCAAE;;oCAAG;kDACzC,8OAAC;wCAAE,OAAO;4CAAE,WAAW;wCAAY;kDAAI;;;;;;;;;;;;;;;;;;kCAKpD,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC;4BAAO,WAAU;4BAAM,SAAS;sCAAc;;;;;;;;;;;;;;;;;0BAMnD,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAG,OAAO;oCAAE,WAAW;gCAAE;0CAAG;;;;;;0CAE7B,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAI,OAAO;4CAAE,YAAY;4CAAK,cAAc;wCAAE;kDAAG;;;;;;kDAClD,8OAAC;wCAAI,OAAO;4CAAE,UAAU;wCAAG;kDACzB,cAAA,8OAAC;sDAAG;;;;;;;;;;;;;;;;;0CAIR,8OAAC;gCAAI,OAAO;oCAAE,WAAW;oCAAI,SAAS;oCAAQ,KAAK;oCAAI,YAAY;oCAAU,UAAU;gCAAO;;kDAC5F,8OAAC;wCACC,WAAU;wCACV,SAAS;wCACT,UAAU,CAAC,QAAQ,MAAM,WAAW,WAAW,QAAQ,MAAM,GAAG,KAAK;wCACrE,OAAM;kDAEL,eAAe,gBAAgB;;;;;;kDAGlC,8OAAC;wCAAK,OAAO;4CAAE,SAAS;4CAAM,UAAU;wCAAG;;4CAAG;0DAC5B,8OAAC;0DAAG,QAAQ,MAAM;;;;;;;;;;;;;;;;;;0CAItC,8OAAC;gCAAI,OAAO;oCAAE,SAAS;oCAAK,UAAU;oCAAI,WAAW;gCAAG;0CAAG;;;;;;;;;;;;kCAK7D,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAG,OAAO;oCAAE,WAAW;gCAAE;0CAAG;;;;;;0CAC7B,8OAAC;gCAAI,WAAU;;oCACZ,QAAQ,GAAG,CAAC,CAAC,kBACZ,8OAAC;4CAAe,WAAU;;8DACxB,8OAAC;oDAAI,WAAU;8DAAQ,EAAE,YAAY;;;;;;8DACrC,8OAAC;oDAAI,WAAU;;wDAAQ;wDAAK,EAAE,YAAY;;;;;;;;2CAFlC,EAAE,EAAE;;;;;oCAKf,QAAQ,MAAM,KAAK,mBAAK,8OAAC;wCAAI,WAAU;kDAAQ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAM5D"}}]
}